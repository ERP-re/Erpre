-- 참조무결성을 위한 외래키 제약
ALTER TABLE m_product
ADD CONSTRAINT fk_category_no
FOREIGN KEY (category_no) REFERENCES m_category(category_no);

ALTER TABLE m_price
ADD CONSTRAINT fk_customer_no
FOREIGN KEY (customer_no) REFERENCES m_customer(customer_no);

ALTER TABLE m_price
ADD CONSTRAINT fk_product_cd
FOREIGN KEY (product_cd) REFERENCES m_product(product_cd);

ALTER TABLE m_category
ADD CONSTRAINT fk_parent_category_no
FOREIGN KEY (parent_category_no) REFERENCES m_category(category_no);

ALTER TABLE m_order_h
ADD CONSTRAINT fk_customer_no
FOREIGN KEY (customer_no) REFERENCES m_customer(customer_no);

ALTER TABLE m_order_h
ADD CONSTRAINT fk_employee_id
FOREIGN KEY (employee_id) REFERENCES m_employee(employee_id);

ALTER TABLE m_order_d
ADD CONSTRAINT fk_order_h_no
FOREIGN KEY (order_h_no) REFERENCES m_order_h(order_h_no);

ALTER TABLE m_order_d
ADD CONSTRAINT fk_product_cd
FOREIGN KEY (product_cd) REFERENCES m_product(product_cd);

-- department_id와 job_id 칼럼을 추가
ALTER TABLE m_employee
ADD COLUMN department_id integer NOT NULL,  -- 부서 ID 추가 (NOT NULL)
ADD COLUMN job_id integer NOT NULL;         -- 직급 ID 추가 (NOT NULL)

-- 직급 추가로 인한 직원권한칼럼 삭제
ALTER TABLE m_employee
DROP COLUMN employee_role;

-- department_id 칼럼에 외래키 제약조건 추가
ALTER TABLE m_employee
ADD CONSTRAINT fk_employee_department
FOREIGN KEY (department_id) REFERENCES m_department(department_id);


-- job_id 칼럼에 외래키 제약조건 추가
ALTER TABLE m_employee
ADD CONSTRAINT fk_employee_job
FOREIGN KEY (job_id) REFERENCES m_job(job_id);


-- 이메일
-- 직원 테이블과 이메일 테이블 간의 외래 키 관계 설정
alter table "m_email"
ADD CONSTRAINT "fk_m_employee_to_m_email_1"
foreign key ("employee_id")
references "m_employee" ("employee_id");
-- 발신자 id를 직원 테이블의 직원 id와 외래 키로 연결


-- 물류창고 테이블과 주문 테이블 간의 외래 키 관계 설정
ALTER TABLE "m_warehouse"
ADD CONSTRAINT "fk_order_to_warehouse"
FOREIGN KEY ("m_order_d_no")
REFERENCES "m_order_d" ("order_d_no");


-- QR코드 테이블과 물류창고 테이블 간의 외래 키 관계 설정
ALTER TABLE "m_qrcode"
ADD CONSTRAINT "fk_qrcode_to_warehouse"
FOREIGN KEY ("warehouse_no")
REFERENCES "m_warehouse"_d ("warehouse_no");

-- QR코드 테이블과 직원 테이블 간의 외래 키 관계 설정
ALTER TABLE "m_qrcode"
ADD CONSTRAINT "fk_qrcode_to_employee"
FOREIGN KEY ("employee_id")
REFERENCES "m_employee" ("employee_id");
